generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model anunciantes {
  id                   Int                    @id(map: "lojas_pkey") @default(autoincrement())
  nome                 String                 @db.VarChar(255)
  tipo                 String                 @default("Padr√£o") @db.VarChar(50)
  descricao            String?
  cnpj                 String?                @db.VarChar(14)
  telefone             String?                @db.VarChar(20)
  email                String?                @db.VarChar(255)
  endereco             String?                @db.VarChar(255)
  cidade               String                 @db.VarChar(100)
  estado               String                 @db.VarChar(2)
  cep                  String?                @db.VarChar(8)
  site                 String?                @db.VarChar(255)
  instagram            String?                @db.VarChar(255)
  facebook             String?                @db.VarChar(255)
  whatsapp             String?                @db.VarChar(20)
  fotoUrl              String?                @db.VarChar(500)
  status               String?                @db.VarChar(50)
  dataCriacao          DateTime               @default(now())
  dataAtualizacao      DateTime
  anuncios             anuncios[]
  movimentos_estoque   movimentos_estoque[]
  produtos_em_estoque  produtos_em_estoque[]
  usuarios_anunciantes usuarios_anunciantes[]
  equipes_de_venda     equipes_de_venda[]
  grupos_produtos      grupos_produtos[]
}

model anuncios {
  id                  Int                     @id @default(autoincrement())
  usuarioId           Int
  anuncianteId        Int
  titulo              String                  @db.VarChar(255)
  descricao           String
  preco               Decimal?                @db.Decimal(10, 2)
  categoria           String?                 @db.VarChar(100)
  imagem              String?                 @db.VarChar(500)
  status              String                  @default("ativo") @db.VarChar(50)
  tipo                String                  @default("produto") @db.VarChar(50)
  isDoacao            Boolean                 @default(false) @map("isdoacao")
  diasRestantes       Int?
  statusPagamento     String?                 @default("pendente") @db.VarChar(50)
  dataCriacao         DateTime                @default(now())
  dataAtualizacao     DateTime
  cidade              String?                 @db.VarChar(100)
  estado              String?                 @db.VarChar(2)
  visualizacoes       Int                     @default(0)
  destaque            Boolean                 @default(false)
  isActive            Boolean                 @default(true)
  anunciantes         anunciantes             @relation(fields: [anuncianteId], references: [id], onDelete: Cascade, map: "anuncios_lojaId_fkey")
  anuncioVisualizados anuncioVisualizados[]
  fotos               fotos_anuncio[]
}

// Anuncio Visualizacoes - Log table to track ad views
model anuncioVisualizados {
  id              Int       @id @default(autoincrement())
  anuncioId       Int
  usuarioId       Int?      // Nullable for anonymous/non-logged-in visitors
  dataCriacao     DateTime  @default(now())
  anuncio         anuncios  @relation(fields: [anuncioId], references: [id], onDelete: Cascade)
  usuario         usracessos? @relation(fields: [usuarioId], references: [id], onDelete: SetNull)

  @@index([anuncioId])
  @@index([usuarioId])
  @@index([dataCriacao])
}

model fotos_grupos {
  id          Int      @id @default(autoincrement())
  grupoId     Int
  url         String   @db.VarChar(500)
  ordem       Int?     @default(1)
  dataCriacao DateTime @default(now())
}

model grupos_produtos {
  id              Int      @id @default(autoincrement())
  usuarioId       Int
  anuncianteId    Int
  nome            String   @db.VarChar(255)
  descricao       String?
  icone           String?  @db.VarChar(50)
  dataCriacao     DateTime @default(now())
  dataAtualizacao DateTime @default(now())
  usuario         usracessos @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  anunciante      anunciantes @relation(fields: [anuncianteId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, anuncianteId, nome])
}

model movimentos_estoque {
  id                  Int                 @id @default(autoincrement())
  anuncianteId        Int
  productId           Int
  tipo                String              @db.VarChar(255)
  quantidade          Int
  motivoSaida         String?             @db.VarChar(255)
  observacoes         String?
  dataCriacao         DateTime            @default(now())
  anunciantes         anunciantes         @relation(fields: [anuncianteId], references: [id], onDelete: Cascade, map: "movimentos_estoque_lojaId_fkey")
  produtos_em_estoque produtos_em_estoque @relation(fields: [anuncianteId, productId], references: [anuncianteId, productId], onDelete: Cascade, map: "movimentos_estoque_lojaId_productId_fkey")
  productos           productos           @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model productos {
  id                  Int                   @id @default(autoincrement())
  lojaId              Int
  grupoId             Int
  nome                String                @db.VarChar(255)
  descricao           String?
  sku                 String?               @db.VarChar(100)
  dataCriacao         DateTime              @default(now())
  dataAtualizacao     DateTime
  grupo               grupos_produtos       @relation(fields: [grupoId], references: [id], onDelete: Cascade)
  movimentos_estoque  movimentos_estoque[]
  produtos_em_estoque produtos_em_estoque[]
}

model productos_visualizacoes {
  id               Int      @id @default(autoincrement())
  usuarioId        Int?
  productId        Int
  dataVisualizacao DateTime @default(now())
}

model produtos_em_estoque {
  id                 Int                  @id @default(autoincrement())
  anuncianteId       Int
  productId          Int
  quantidade         Int                  @default(0)
  quantidadeMinima   Int?                 @default(0)
  quantidadeMaxima   Int?
  dataCriacao        DateTime             @default(now())
  dataAtualizacao    DateTime
  movimentos_estoque movimentos_estoque[]
  anunciantes        anunciantes          @relation(fields: [anuncianteId], references: [id], onDelete: Cascade, map: "produtos_em_estoque_lojaId_fkey")
  productos          productos            @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([anuncianteId, productId], map: "produtos_em_estoque_lojaId_productId_key")
}

model qrcodes {
  id              Int      @id @default(autoincrement())
  lojaId          Int
  productId       Int
  codigo          String   @unique @db.VarChar(255)
  localizacao     String?  @db.VarChar(255)
  ativo           Boolean  @default(true)
  dataCriacao     DateTime @default(now())
  dataAtualizacao DateTime

  @@unique([lojaId, productId])
}

model qrcodes_chamadas {
  id          Int      @id @default(autoincrement())
  qrcodeId    Int
  dataChamada DateTime @default(now())
}

model tabelas_preco {
  id              Int      @id @default(autoincrement())
  productId       Int
  lojaId          Int
  tamanho         String?  @db.VarChar(50)
  cor             String?  @db.VarChar(50)
  preco           Decimal  @db.Decimal(10, 2)
  dataCriacao     DateTime @default(now())
  dataAtualizacao DateTime

  @@unique([productId, lojaId, tamanho, cor])
}

model usracessos {
  id                    Int                    @id @default(autoincrement())
  nome                  String                 @db.VarChar(255)
  email                 String                 @unique @db.VarChar(255)
  senha                 String                 @db.VarChar(255)
  cpf                   String?                @db.VarChar(14) @unique
  telefone              String?                @db.VarChar(20)
  whatsapp              String?                @db.VarChar(20)
  linkedin              String?                @db.VarChar(255)
  facebook              String?                @db.VarChar(255)
  tipoUsuario           String                 @default("common") @db.VarChar(20)
  dataCriacao           DateTime               @default(now())
  dataAtualizacao       DateTime
  endereco              String?
  dataVigenciaContrato  DateTime               @default(now())
  numeroAnunciosAtivos  Int                    @default(0)
  usuarios_anunciantes  usuarios_anunciantes[]
  membros_equipe        membros_equipe[]
  passwordResetTokens   passwordResetToken[]
  anuncioVisualizados   anuncioVisualizados[]
  fotos_anuncio         fotos_anuncio[]
  grupos_produtos       grupos_produtos[]
}

model passwordResetToken {
  id        Int       @id @default(autoincrement())
  usuarioId Int
  token     String    @unique @db.VarChar(500)
  expiresAt DateTime
  createdAt DateTime  @default(now())
  usuario   usracessos @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId])
}

model usuarios_anunciantes {
  id           Int         @id(map: "usuarios_lojas_pkey") @default(autoincrement())
  usuarioId    Int
  anuncianteId Int
  papel        String      @default("attendant") @db.VarChar(50)
  dataCriacao  DateTime    @default(now())
  anunciantes  anunciantes @relation(fields: [anuncianteId], references: [id], onDelete: Cascade, map: "usuarios_lojas_lojaId_fkey")
  usuario      usracessos  @relation(fields: [usuarioId], references: [id], onDelete: Cascade, map: "usuarios_lojas_usuarioId_fkey")

  @@unique([usuarioId, anuncianteId], map: "usuarios_lojas_usuarioId_lojaId_key")
}

// Equipes de Venda (Sales Teams)
model equipes_de_venda {
  id              Int               @id @default(autoincrement())
  anuncianteId    Int
  nome            String            @db.VarChar(255)
  descricao       String?           @db.Text
  isActive        Boolean           @default(true)
  dataCriacao     DateTime          @default(now())
  dataAtualizacao DateTime          @updatedAt
  anunciantes     anunciantes       @relation(fields: [anuncianteId], references: [id], onDelete: Cascade)
  membros_equipe  membros_equipe[]

  @@map("equipes_de_venda")
}

// Membros da Equipe de Venda (Sales Team Members)
model membros_equipe {
  id              Int                @id @default(autoincrement())
  equipeId        Int
  usuarioId       Int
  nomeMembro      String             @db.VarChar(255)
  email           String             @db.VarChar(255)
  whatsapp        String?            @db.VarChar(20)
  status          String             @default("disponivel")
  dataCriacao     DateTime           @default(now())
  dataAtualizacao DateTime           @updatedAt
  equipe          equipes_de_venda   @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  usuario         usracessos         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([equipeId, email])
  @@map("membros_equipe")
}

// Banners - Admin managed promotional banners for homepage
model banners {
  id              Int       @id @default(autoincrement())
  titulo          String    @db.VarChar(255)
  descricao       String?   @db.Text
  imagemUrl       String    @db.VarChar(500)
  link            String?   @db.VarChar(500)
  ordem           Int       @default(0)
  ativo           Boolean   @default(true)
  dataCriacao     DateTime  @default(now())
  dataAtualizacao DateTime  @updatedAt

  @@map("banners")
}

// Fotos de Anuncio - Multiple images per ad (up to 5)
model fotos_anuncio {
  id                Int       @id @default(autoincrement())
  anuncio_id        Int
  url               String    @db.VarChar(500)
  ordem             Int       @default(1)
  criado_por        Int
  data_criacao      DateTime  @default(now())
  data_atualizacao  DateTime  @default(now())

  anuncio           anuncios  @relation(fields: [anuncio_id], references: [id], onDelete: Cascade)
  usuario           usracessos @relation(fields: [criado_por], references: [id], onDelete: Restrict)

  @@index([anuncio_id])
  @@index([anuncio_id, ordem])
}
